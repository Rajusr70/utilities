#!/bin/bash

url=http://s3.amazonaws.com/ninja_modules
module_dir=/opt/ninja/ninja_modules

if [[ $# -ne 1 ]]; then
	echo "Usage: `basename $0` <module name>"
	exit 1
fi

if [[ -d $module_dir/$1 ]]; then
	echo "$1 module already exists"
	exit 1
fi

wget -q --spider $url/$1.tgz
modAvail=$?
wget -q --spider $url/$1.checksum
chkAvail=$?

if [[ $modAvail -ne 0 ]] || [[ $chkAvail -ne 0 ]]
then
	echo "The module $1 is not available "
	exit 1
fi

echo "Installing $1 module"
cd /tmp

curl -s --output $1.tgz $url/$1.tgz
remote_checksum=$(curl -s $url/$1.checksum | awk '{ print $1 }')
local_checksum=$(sha1sum $1.tgz | awk '{ print $1 }')

if [ -e $1.tgz ] && [ -n "$remote_checksum" ] && [ "$remote_checksum" = "$local_checksum" ]; then
	tar -C $module_dir -xzf $1.tgz
	rm $1.tgz
	echo "Done."
fi





